{"id":"../node_modules/@springtype/springtype-incubator/dist/html/src/decorator/WebComponent.js","dependencies":[{"name":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/node_modules/@springtype/springtype-incubator/dist/html/src/decorator/WebComponent.js.map","includedInParent":true,"mtime":1538584912633},{"name":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/node_modules/@springtype/springtype-incubator/src/html/src/decorator/WebComponent.ts","includedInParent":true,"mtime":1538582317476},{"name":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/package.json","includedInParent":true,"mtime":1538585011922},{"name":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/node_modules/@springtype/springtype-incubator/package.json","includedInParent":true,"mtime":1538575570092},{"name":"../ui/JSXRenderer","loc":{"line":3,"column":8},"parent":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/node_modules/@springtype/springtype-incubator/dist/html/src/decorator/WebComponent.js","resolved":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/node_modules/@springtype/springtype-incubator/dist/html/src/ui/JSXRenderer.js"},{"name":"../../../di","loc":{"line":4,"column":21},"parent":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/node_modules/@springtype/springtype-incubator/dist/html/src/decorator/WebComponent.js","resolved":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/node_modules/@springtype/springtype-incubator/dist/di/index.js"},{"name":"../../../di/src/ApplicationContext","loc":{"line":5,"column":37},"parent":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/node_modules/@springtype/springtype-incubator/dist/html/src/decorator/WebComponent.js","resolved":"/Users/aron/IdeaProjects/springtype-incubator/examples/hello-world/node_modules/@springtype/springtype-incubator/dist/di/src/ApplicationContext.js"}],"generated":{"js":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nrequire(\"../ui/JSXRenderer\");\nconst di_1 = require(\"../../../di\");\nconst ApplicationContext_1 = require(\"../../../di/src/ApplicationContext\");\nvar ShadowAttachMode;\n(function (ShadowAttachMode) {\n    ShadowAttachMode[\"OPEN\"] = \"open\";\n    ShadowAttachMode[\"CLOSED\"] = \"closed\";\n})(ShadowAttachMode = exports.ShadowAttachMode || (exports.ShadowAttachMode = {}));\nclass WebComponentLifecycle {\n    constructor() {\n        this.state = {};\n    }\n    init() { }\n    mount() { }\n    render() {\n        return ('');\n    }\n    unmount() { }\n    onPropChange(prop, newValue, oldValue) { }\n    ;\n    onStateChange(prop, state) { }\n}\nexports.WebComponentLifecycle = WebComponentLifecycle;\nvar LifecycleEvent;\n(function (LifecycleEvent) {\n    LifecycleEvent[\"INIT\"] = \"INIT\";\n    LifecycleEvent[\"SHADOW_ATTACHED\"] = \"SHADOW_ATTACHED\";\n    LifecycleEvent[\"CONNECTED\"] = \"CONNECTED\";\n    LifecycleEvent[\"DISCONNECTED\"] = \"DISCONNECTED\";\n    LifecycleEvent[\"PROPERTY_CHANGE\"] = \"PROPERTY_CHANGE\";\n    LifecycleEvent[\"STATE_CHANGE\"] = \"STATE_CHANGE\";\n})(LifecycleEvent = exports.LifecycleEvent || (exports.LifecycleEvent = {}));\nfunction WebComponent(config) {\n    if (!config.props)\n        config.props = [];\n    return (target) => {\n        let derivedCustomWebComponent = class extends target {\n            constructor(...args) {\n                super();\n                // initialize state\n                this.state = {};\n                if (config.shadow) {\n                    this.attachShadow({\n                        mode: config.shadowMode ? config.shadowMode : ShadowAttachMode.OPEN\n                    });\n                }\n                this.dispatchEvent(new CustomEvent(LifecycleEvent.INIT));\n                this.init();\n            }\n            static get observedAttributes() {\n                return config.props;\n            }\n            attributeChangedCallback(prop, oldValue, newValue) {\n                this.dispatchEvent(new CustomEvent(LifecycleEvent.PROPERTY_CHANGE, {\n                    detail: {\n                        prop,\n                        oldValue,\n                        newValue\n                    }\n                }));\n                this.onPropChange(prop, newValue, oldValue);\n                if (newValue.startsWith('state')) {\n                    this.changeState(prop, newValue);\n                }\n            }\n            changeState(prop, stateHeapPtr) {\n                const propState = window.React.stateHeapCache[stateHeapPtr];\n                delete window.React.stateHeapCache[stateHeapPtr];\n                if (this.state) {\n                    this.state[prop] = propState;\n                    this.onStateChange(prop, propState);\n                }\n            }\n            connectedCallback() {\n                this.dispatchEvent(new CustomEvent(LifecycleEvent.CONNECTED));\n                this.mount();\n                const element = this.render();\n                if (element) {\n                    if (config.shadow) {\n                        this.shadowRoot.appendChild(element.cloneNode(true));\n                    }\n                    else {\n                        this.appendChild(element.cloneNode(true));\n                    }\n                }\n            }\n            disconnectedCallback() {\n                this.dispatchEvent(new CustomEvent(LifecycleEvent.DISCONNECTED));\n                return this.unmount();\n            }\n            init() {\n                if (super.init) {\n                    super.init();\n                }\n            }\n            onPropChange(prop, oldValue, newValue) {\n                if (super.onPropChange) {\n                    return super.onPropChange(prop, oldValue, newValue);\n                }\n            }\n            onStateChange(prop, state) {\n                if (super.onStateChange) {\n                    return super.onStateChange(prop, state);\n                }\n            }\n            mount() {\n                if (super.mount) {\n                    return super.mount();\n                }\n            }\n            render() {\n                if (super.render) {\n                    return super.render();\n                }\n                else {\n                    return ('');\n                }\n            }\n        };\n        try {\n            // register custom element\n            window.customElements.define(config.tag, derivedCustomWebComponent);\n        }\n        catch (e) {\n            if (di_1.ApplicationContext.getInstance().getEnvironment() === ApplicationContext_1.ApplicationEnvironment.DEV) {\n                window.location.href = '/';\n            }\n            throw e;\n        }\n        return derivedCustomWebComponent;\n    };\n}\nexports.WebComponent = WebComponent;\n","map":{"version":3,"file":"WebComponent.js","sourceRoot":"","sources":["../../../../src/html/src/decorator/WebComponent.ts"],"names":[],"mappings":"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","sourcesContent":["import \"../ui/JSXRenderer\";\nimport {ApplicationContext} from \"../../../di\";\nimport {ApplicationEnvironment} from \"../../../di/src/ApplicationContext\";\n\nexport enum ShadowAttachMode {\n    OPEN = 'open',\n    CLOSED = 'closed'\n}\n\nexport interface WebComponentConfig {\n    tag: string;\n    shadow?: boolean;\n    shadowMode?: ShadowAttachMode;\n    props?: Array<string>;\n}\n\nexport class WebComponentLifecycle  {\n    state?: any = {};\n    init?(): void {}\n    mount?(): void {}\n    render?(): JSX.Element {\n        return ('');\n    }\n    unmount?(): void {}\n    onPropChange?(prop: string, newValue: any, oldValue?: any): void {};\n    onStateChange?(prop: string, state: any): void {}\n}\n\nexport interface PropertyChangeEvent {\n    prop: string;\n    newValue: any;\n    oldValue: any;\n}\n\nexport enum LifecycleEvent {\n    INIT = 'INIT',\n    SHADOW_ATTACHED = 'SHADOW_ATTACHED',\n    CONNECTED = 'CONNECTED',\n    DISCONNECTED = 'DISCONNECTED',\n    PROPERTY_CHANGE = 'PROPERTY_CHANGE',\n    STATE_CHANGE = 'STATE_CHANGE'\n}\n\nexport interface IWebComponent<WC> extends Function {\n    new(...args: any[]): WC;\n}\n\nexport function WebComponent<WC extends IWebComponent<any>>(config: WebComponentConfig): any {\n\n    if (!config.props) config.props = [];\n\n    return (target: WC) => {\n\n        let derivedCustomWebComponent = class extends target {\n\n            constructor(...args: Array<any>) {\n\n                super();\n\n                // initialize state\n                this.state = {};\n\n                if (config.shadow) {\n\n                    this.attachShadow({\n                        mode: config.shadowMode ? config.shadowMode : ShadowAttachMode.OPEN\n                    });\n                }\n\n                this.dispatchEvent(new CustomEvent(LifecycleEvent.INIT));\n\n                this.init();\n            }\n\n            static get observedAttributes() {\n                return config.props;\n            }\n\n            attributeChangedCallback(prop: string, oldValue: string, newValue: string) {\n\n                this.dispatchEvent(new CustomEvent(LifecycleEvent.PROPERTY_CHANGE,  {\n                    detail: <PropertyChangeEvent> {\n                        prop,\n                        oldValue,\n                        newValue\n                    }\n                }));\n\n                this.onPropChange(prop, newValue, oldValue);\n\n                if (newValue.startsWith('state')) {\n                    this.changeState(prop, newValue);\n                }\n            }\n\n            changeState(prop: string, stateHeapPtr: string): void {\n\n                const propState = (<any>window).React.stateHeapCache[stateHeapPtr];\n\n                delete (<any>window).React.stateHeapCache[stateHeapPtr];\n\n                if (this.state) {\n                    this.state[prop] = propState;\n                    this.onStateChange(prop, propState);\n                }\n            }\n\n            connectedCallback() {\n\n                this.dispatchEvent(new CustomEvent(LifecycleEvent.CONNECTED));\n\n                this.mount();\n\n                const element: HTMLElement = <any> this.render();\n\n                if (element) {\n\n                    if (config.shadow) {\n                        this.shadowRoot.appendChild(element.cloneNode(true));\n                    } else {\n                        this.appendChild(element.cloneNode(true));\n                    }\n                }\n            }\n\n            disconnectedCallback() {\n\n                this.dispatchEvent(new CustomEvent(LifecycleEvent.DISCONNECTED));\n\n                return this.unmount();\n            }\n\n            init(): void {\n\n                if (super.init) {\n                    super.init();\n                }\n            }\n\n            onPropChange(prop: string, oldValue: string, newValue: string): void {\n\n                if (super.onPropChange) {\n                    return super.onPropChange(prop, oldValue, newValue);\n                }\n            }\n\n            onStateChange(prop: string, state: any): void {\n\n                if (super.onStateChange) {\n                    return super.onStateChange(prop, state);\n                }\n            }\n\n            mount() {\n\n                if (super.mount) {\n                    return super.mount();\n                }\n            }\n\n            render(): JSX.Element {\n\n                if (super.render) {\n                    return super.render();\n                } else {\n                    return ('');\n                }\n            }\n        };\n\n        try {\n\n            // register custom element\n            window.customElements.define(config.tag, derivedCustomWebComponent);\n\n        } catch(e) {\n\n            if (ApplicationContext.getInstance().getEnvironment() === ApplicationEnvironment.DEV) {\n                window.location.href = '/';\n            }\n            throw e;\n        }\n        return derivedCustomWebComponent;\n    }\n}"]}},"hash":"de1714590ffe163c247925de103a5d7d","cacheData":{"env":{}}}